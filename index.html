<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supermarket Manager - Customers Edition</title>
    <style>
        :root { --main: #00a2ff; --bg: #121212; }
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; }
        
        #top-bar {
            position: absolute; top: 0; width: 100%; display: flex; justify-content: space-around;
            background: rgba(0,0,0,0.8); padding: 15px 0; z-index: 100;
        }
        .stat-box { background: rgba(255,255,255,0.1); padding: 5px 20px; border-radius: 20px; border: 1px solid var(--main); }

        /* Ø§Ù„ÙƒØ§Ø´ÙŠØ± */
        #checkout-panel {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #222; padding: 15px; border-radius: 15px; display: none; z-index: 150;
        }
        .btn-pay { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

        #shop-trigger { position: absolute; bottom: 20px; left: 20px; background: #ffcc00; color: #000; padding: 15px 30px; border-radius: 30px; cursor: pointer; z-index: 100; }
    </style>
</head>
<body>

    <div id="top-bar">
        <div class="stat-box">ğŸ’° Ø§Ù„Ù…Ø§Ù„: <span id="money-ui">500</span>$</div>
        <div class="stat-box">ğŸ‘¥ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ÙÙŠ Ø§Ù„Ù…Ø­Ù„: <span id="cust-count">0</span></div>
    </div>

    <div id="shop-trigger" onclick="toggleMarket()">ğŸ›’ Ø·Ù„Ø¨ Ø¨Ø¶Ø§Ø¦Ø¹</div>

    <div id="checkout-panel" id="checkout-ui">
        <p>Ù‡Ù†Ø§Ùƒ Ø²Ø¨ÙˆÙ† ÙŠÙ†ØªØ¸Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙƒØ§Ø´ÙŠØ±!</p>
        <button class="btn-pay" onclick="processCheckout()">Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø²Ø¨ÙˆÙ† (+25$)</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 0.8);
        sun.position.set(10, 20, 10);
        scene.add(sun);

        // Ø§Ù„Ø£Ø±Ø¶ÙŠØ© ÙˆØ§Ù„Ù…Ø­Ù„
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(40, 40), new THREE.MeshPhongMaterial({ color: 0x444444 }));
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        const storeFloor = new THREE.Mesh(new THREE.BoxGeometry(16, 0.2, 12), new THREE.MeshPhongMaterial({ color: 0xeeeeee }));
        storeFloor.position.y = 0.1;
        scene.add(storeFloor);

        // Ø§Ù„ÙƒØ§Ø´ÙŠØ± (Ø§Ù„Ù…ÙƒØªØ¨)
        const counter = new THREE.Mesh(new THREE.BoxGeometry(2, 1.2, 4), new THREE.MeshPhongMaterial({color: 0x333}));
        counter.position.set(-6, 0.7, 0);
        scene.add(counter);

        // Ø§Ù„Ù„Ø§Ø¹Ø¨
        const player = new THREE.Mesh(new THREE.BoxGeometry(0.6, 1.5, 0.6), new THREE.MeshPhongMaterial({color: 0x00a2ff}));
        player.position.set(-5, 0.8, 0);
        scene.add(player);

        // Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
        const customers = [];
        let money = 500;

        function spawnCustomer() {
            const cust = new THREE.Mesh(new THREE.CapsuleGeometry(0.3, 0.8), new THREE.MeshPhongMaterial({color: Math.random() * 0xffffff}));
            cust.position.set(15, 0.8, Math.random() * 10 - 5);
            cust.userData = { state: 'entering', target: new THREE.Vector3(Math.random()*4, 0.8, Math.random()*4) };
            scene.add(cust);
            customers.push(cust);
            document.getElementById('cust-count').innerText = customers.length;
        }

        setInterval(spawnCustomer, 8000); // Ø²Ø¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯ ÙƒÙ„ 8 Ø«ÙˆØ§Ù†Ù

        function processCheckout() {
            const waitingCust = customers.find(c => c.userData.state === 'waiting');
            if (waitingCust) {
                money += 25;
                waitingCust.userData.state = 'leaving';
                document.getElementById('money-ui').innerText = money;
                document.getElementById('checkout-panel').style.display = 'none';
            }
        }

        const keys = {};
        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function animate() {
            requestAnimationFrame(animate);
            
            // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
            if(keys['ArrowUp']) player.position.z -= 0.1;
            if(keys['ArrowDown']) player.position.z += 0.1;
            if(keys['ArrowLeft']) player.position.x -= 0.1;
            if(keys['ArrowRight']) player.position.x += 0.1;

            // Ø°ÙƒØ§Ø¡ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
            customers.forEach(c => {
                if (c.userData.state === 'entering') {
                    c.position.lerp(c.userData.target, 0.02);
                    if (c.position.distanceTo(c.userData.target) < 0.5) c.userData.state = 'shopping';
                } 
                else if (c.userData.state === 'shopping') {
                    const checkoutPos = new THREE.Vector3(-4, 0.8, 0);
                    c.position.lerp(checkoutPos, 0.01);
                    if (c.position.distanceTo(checkoutPos) < 0.5) {
                        c.userData.state = 'waiting';
                        if (player.position.distanceTo(counter.position) < 2) {
                            document.getElementById('checkout-panel').style.display = 'block';
                        }
                    }
                }
                else if (c.userData.state === 'leaving') {
                    const exitPos = new THREE.Vector3(15, 0.8, 0);
                    c.position.lerp(exitPos, 0.03);
                }
            });

            camera.position.lerp(new THREE.Vector3(player.position.x, 10, player.position.z + 10), 0.1);
            camera.lookAt(player.position);
            renderer.render(scene, camera);
        }
        animate();

        function toggleMarket() { alert("ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø¶Ø§Ø¦Ø¹ Ø¨Ù†Ø¬Ø§Ø­!"); }
    </script>
</body>
</html>
